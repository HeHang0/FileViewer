<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: var(--background-color);
      }
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-thumb {
        background-color: #acadae;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background-color: #7b7c7c;
      }
    </style>
  </head>
  <body>
    <script>
      const queryParams = window.location.search;
      const isDarkMode = queryParams.includes('dark=1');
      var backgroundColor = isDarkMode ? '#1E1E1E' : '#FFFFFE';
      var styleElement = document.createElement('style');
      var styleContent = `:root { --background-color: ${backgroundColor}; }`;
      styleElement.innerHTML = styleContent;
      document.head.appendChild(styleElement);
    </script>
    <div id="container" style="width: 100vw; height: 100vh"></div>

    <!-- Load the Monaco Editor -->
    <script src="http://FileViewerLocalMonaco/loader.js"></script>
    <script>
      require.config({
        paths: {
          vs: 'http://FileViewerLocalMonaco'
        }
      });
      let editor;
      const darkModeMediaQuery = window.matchMedia(
        '(prefers-color-scheme: dark)'
      );
      const languageMatch = { '.xsd': 'xml', '.sln': 'vb', '.gitignore': 'ini', '.gitattributes': 'ini' };
      require(['vs/editor/editor.main'], function () {
        editor = monaco.editor.create(document.getElementById('container'), {
          language: 'plaintext',
          readOnly: true,
          automaticLayout: true,
          wordWrap: 'on',
          theme: isDarkMode ? 'vs-dark' : 'vs',
          scrollBeyondLastLine: false
        });
        const languages = monaco.languages.getLanguages();
        languages.map(m => {
          Array.isArray(m.extensions) &&
            m.extensions.map(ext => {
              languageMatch[ext.toLowerCase()] = m.id;
            });
        });
        window.chrome.webview?.postMessage('loaded');
      });
      window.chrome.webview?.addEventListener('message', event => {
        let data = event.data;
        switch (data.message) {
          case 'extension':
            editor &&
              monaco.editor.setModelLanguage(
                editor.getModel(),
                languageMatch[data.value] || 'plaintext'
              );
            break;
          case 'text':
            editor && editor.getModel().setValue(data.value);
            break;
          case 'load-file':
            window.chrome.webview?.postMessage('loaded');
            break;
          case 'theme':
            monaco &&
              monaco.editor.setTheme(data.value == 'dark' ? 'vs-dark' : 'vs');
            break;
        }
      });
    </script>
  </body>
</html>
